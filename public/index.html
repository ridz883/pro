<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>All Ridzkey Downloader</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: sans-serif; background-color: #0f172a; color: white; }
        .tab-btn.active { background-color: #3b82f6; color: white; border-color: #3b82f6; }
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #3b82f6; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4">

    <header class="w-full max-w-2xl mt-8 mb-8 text-center">
        <h1 class="text-3xl font-bold text-blue-400">All Ridzkey</h1>
        <p class="text-slate-400 text-xs mt-2">All-in-One Downloader (Stable Version)</p>
    </header>

    <main class="w-full max-w-2xl bg-slate-800 rounded-2xl shadow-2xl border border-slate-700 overflow-hidden">
        <div class="p-6">
            <div class="relative">
                <input type="text" id="urlInput" placeholder="Tempel link video di sini..." 
                    class="w-full bg-slate-900 border border-slate-600 px-5 py-4 rounded-xl focus:outline-none focus:border-blue-500 text-sm">
            </div>

            <button onclick="startDownload()" id="btnDl" class="w-full mt-4 bg-blue-600 hover:bg-blue-500 py-4 rounded-xl font-bold flex justify-center items-center gap-2">
                <span>Download Sekarang</span>
            </button>

            <div id="msg" class="hidden mt-4 p-3 bg-red-500/10 text-red-400 rounded-lg text-xs text-center"></div>
        </div>
    </main>

    <section id="resSection" class="w-full max-w-2xl mt-6 hidden">
        <div class="bg-slate-800 rounded-2xl p-5 border border-slate-700" id="resContent"></div>
    </section>

    <script>
        const API_PATH = '/download'; 

        async function startDownload() {
            const input = document.getElementById('urlInput');
            const btn = document.getElementById('btnDl');
            const msg = document.getElementById('msg');
            const resSec = document.getElementById('resSection');
            
            if(!input.value) return;
            
            msg.classList.add('hidden');
            resSec.classList.add('hidden');
            btn.disabled = true;
            btn.innerHTML = `<div class="loader"></div>`;

            try {
                const r = await fetch(`${API_PATH}?url=${encodeURIComponent(input.value)}`);
                const json = await r.json();
                render(json);
            } catch (e) {
                msg.innerText = "Server sibuk, coba lagi nanti.";
                msg.classList.remove('hidden');
            } finally {
                btn.disabled = false;
                btn.innerHTML = `<span>Download Sekarang</span>`;
            }
        }

        function render(res) {
            const content = document.getElementById('resContent');
            document.getElementById('resSection').classList.remove('hidden');
            
            // --- AUTO SCANNER LOGIC (Mencari link sampai ketemu) ---
            let d = res.data || res.result || res; 
            let video = d.video || d.url || d.link || (d.metadata ? d.metadata.video : null) || (d.urls ? d.urls[0] : null);
            let thumb = d.thumbnail || d.cover || d.image || (d.metadata ? d.metadata.thumbnail : '');
            let title = d.title || d.caption || 'Video Berhasil Ditemukan';

            // Jika masih tidak ketemu, coba scan isi object d secara brutal
            if(!video) {
                for (let key in d) {
                    if (typeof d[key] === 'string' && d[key].startsWith('http') && (d[key].includes('mp4') || d[key].includes('googlevideo'))) {
                        video = d[key];
                        break;
                    }
                }
            }

            let html = `<div class="flex flex-col gap-4">`;
            if(thumb) html += `<img src="${thumb}" class="w-full rounded-lg">`;
            html += `<p class="text-sm font-bold">${title}</p>`;
            
            if(video) {
                html += `<a href="${video}" target="_blank" class="block w-full bg-green-600 text-center py-4 rounded-xl font-bold">KLIK UNTUK DOWNLOAD MP4</a>`;
            } else {
                html += `<p class="text-yellow-500 text-xs">Link MP4 tidak ditemukan dalam data API. Coba ganti URL.</p>`;
            }
            
            html += `</div>`;
            content.innerHTML = html;
        }
    </script>
</body>
</html>
