<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>All Ridzkey Downloader</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #0f172a; color: white; }
        .tab-btn.active { background-color: #3b82f6; color: white; border-color: #3b82f6; }
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #3b82f6; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4">

    <header class="w-full max-w-2xl mt-8 mb-8 text-center">
        <h1 class="text-3xl font-bold text-blue-400"><i class="fa-solid fa-cloud-arrow-down mr-2"></i> All Ridzkey</h1>
        <p class="text-slate-400 text-xs mt-2">One Site for All Your Downloads (Anti-Error Engine)</p>
    </header>

    <main class="w-full max-w-2xl bg-slate-800 rounded-2xl shadow-2xl border border-slate-700 overflow-hidden">
        <div class="flex overflow-x-auto p-3 bg-slate-900/50 space-x-2 no-scrollbar" id="tabs"></div>

        <div class="p-6">
            <div id="platformLabel" class="text-center mb-6"></div>

            <div class="relative">
                <input type="text" id="urlInput" placeholder="Tempel link video di sini..." 
                    class="w-full bg-slate-900 border border-slate-600 px-5 py-4 rounded-xl focus:outline-none focus:border-blue-500 transition-all pl-12 text-sm">
                <i class="fa-solid fa-link absolute left-4 top-1/2 -translate-y-1/2 text-slate-500"></i>
            </div>

            <button onclick="startDownload()" id="btnDl" class="w-full mt-4 bg-blue-600 hover:bg-blue-500 py-4 rounded-xl font-bold transition-all flex justify-center items-center gap-2">
                <span>Download Sekarang</span> <i class="fa-solid fa-download"></i>
            </button>

            <div id="msg" class="hidden mt-4 p-3 bg-red-500/10 border border-red-500/50 text-red-400 rounded-lg text-xs text-center"></div>
        </div>
    </main>

    <section id="resSection" class="w-full max-w-2xl mt-6 hidden">
        <div class="bg-slate-800 rounded-2xl p-5 border border-slate-700">
            <h3 class="text-sm font-semibold mb-4 text-slate-400 border-b border-slate-700 pb-2">Hasil Ditemukan:</h3>
            <div id="resContent" class="flex flex-col sm:flex-row gap-4"></div>
        </div>
    </section>

    <script>
        // KONFIGURASI - Tanpa Localhost agar tidak ada notif izin
        const API_PATH = '/download'; 

        const platforms = [
            { id: 'tt', name: 'TikTok', icon: 'fa-tiktok', color: 'text-pink-500' },
            { id: 'ig', name: 'Instagram', icon: 'fa-instagram', color: 'text-purple-500' },
            { id: 'yt', name: 'YouTube', icon: 'fa-youtube', color: 'text-red-500' },
            { id: 'fb', name: 'Facebook', icon: 'fa-facebook', color: 'text-blue-500' }
        ];

        let active = platforms[0];

        function init() {
            const container = document.getElementById('tabs');
            platforms.forEach(p => {
                const b = document.createElement('button');
                b.className = `tab-btn px-4 py-2 rounded-full border border-slate-600 text-xs whitespace-nowrap transition-all ${p.id===active.id?'active':''}`;
                b.innerHTML = `<i class="fa-brands ${p.icon}"></i> ${p.name}`;
                b.onclick = () => {
                    active = p;
                    document.querySelectorAll('.tab-btn').forEach(x => x.classList.remove('active'));
                    b.classList.add('active');
                    updateLabel();
                };
                container.appendChild(b);
            });
            updateLabel();
        }

        function updateLabel() {
            document.getElementById('platformLabel').innerHTML = `
                <i class="fa-brands ${active.icon} text-4xl mb-2 ${active.color}"></i>
                <h2 class="text-lg font-semibold">${active.name} Downloader</h2>
            `;
        }

        async function startDownload() {
            const input = document.getElementById('urlInput');
            const btn = document.getElementById('btnDl');
            const msg = document.getElementById('msg');
            const resSec = document.getElementById('resSection');
            
            if(!input.value) return;
            
            msg.classList.add('hidden');
            resSec.classList.add('hidden');
            btn.disabled = true;
            btn.innerHTML = `<div class="loader"></div>`;

            try {
                const r = await fetch(`${API_PATH}?url=${encodeURIComponent(input.value)}`);
                const json = await r.json();

                if(!json.status && !json.video && !json.url) throw new Error(json.message || "Gagal mengambil data.");
                
                render(json);
            } catch (e) {
                msg.innerText = "Server sedang sibuk, silakan coba lagi.";
                msg.classList.remove('hidden');
            } finally {
                btn.disabled = false;
                btn.innerHTML = `<span>Download Sekarang</span> <i class="fa-solid fa-download"></i>`;
            }
        }

        function render(res) {
            const content = document.getElementById('resContent');
            document.getElementById('resSection').classList.remove('hidden');
            
            // Mencari data di berbagai kemungkinan struktur API (Deline / Tikly / Fallback)
            const d = res.data || res;
            const thumb = d.thumbnail || d.cover || d.image || '';
            const title = d.title || d.caption || 'Video Berhasil Diproses';
            
            // Mencari Link Download
            const video = d.video || d.url || (d.metadata ? d.metadata.video : null);
            const audio = d.audio || d.music || (d.metadata ? d.metadata.audio : null);

            let html = thumb ? `<img src="${thumb}" class="w-full sm:w-40 rounded-lg object-cover bg-slate-900">` : '';
            html += `<div class="flex-1">
                <p class="text-sm font-medium mb-3 line-clamp-2">${title}</p>`;
            
            if(video) html += createBtn(video, "Download Video (MP4)", "fa-video");
            if(audio) html += createBtn(audio, "Download Audio (MP3)", "fa-music");
            
            if(!video && !audio) html += `<p class="text-yellow-500 text-xs">Link tidak ditemukan, coba URL lain.</p>`;
            
            html += `</div>`;
            content.innerHTML = html;
        }

        function createBtn(link, txt, icon) {
            return `<a href="${link}" target="_blank" class="flex items-center justify-center gap-2 w-full bg-slate-700 hover:bg-slate-600 py-3 rounded-lg text-xs mb-2 transition-all border border-slate-600">
                <i class="fa-solid ${icon}"></i> ${txt}
            </a>`;
        }

        init();
    </script>
</body>
</html>
