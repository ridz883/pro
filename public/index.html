<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Ridzkey Downloader</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Poppins', sans-serif; }
        .tab-btn.active {
            background-color: #3b82f6; /* Blue-500 */
            color: white;
            border-color: #3b82f6;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-slate-900 text-white min-h-screen flex flex-col items-center p-4">

    <header class="w-full max-w-3xl mt-6 mb-8 text-center">
        <h1 class="text-3xl md:text-4xl font-bold text-blue-400 mb-2">
            <i class="fa-solid fa-cloud-arrow-down mr-2"></i> All Ridzkey
        </h1>
        <p class="text-slate-400 text-sm">One Site for All Your Downloads (API + Scraping Engine)</p>
    </header>

    <main class="w-full max-w-3xl bg-slate-800 rounded-2xl shadow-2xl overflow-hidden border border-slate-700">
        
        <div class="flex overflow-x-auto p-2 bg-slate-900/50 space-x-2 scrollbar-hide" id="platformTabs">
            </div>

        <div class="p-6 md:p-8">
            <div class="text-center mb-6" id="activePlatformLabel">
                <i class="fa-brands fa-tiktok text-4xl mb-2 text-pink-500"></i>
                <h2 class="text-xl font-semibold">TikTok Downloader</h2>
            </div>

            <div class="relative">
                <input type="text" id="urlInput" placeholder="Tempel link di sini..." 
                    class="w-full bg-slate-900 border border-slate-600 text-white px-5 py-4 rounded-xl focus:outline-none focus:border-blue-500 transition-colors pl-12">
                <i class="fa-solid fa-link absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-500"></i>
            </div>

            <button onclick="processDownload()" id="downloadBtn"
                class="w-full mt-4 bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white font-bold py-4 rounded-xl transition-all shadow-lg transform active:scale-95 flex justify-center items-center gap-2">
                <span>Download Sekarang</span>
                <i class="fa-solid fa-download"></i>
            </button>

            <div id="errorMsg" class="hidden mt-4 p-3 bg-red-500/10 border border-red-500/50 text-red-400 rounded-lg text-sm text-center"></div>
        </div>
    </main>

    <div id="resultSection" class="w-full max-w-3xl mt-6 hidden">
        <div class="bg-slate-800 rounded-2xl p-6 border border-slate-700 shadow-xl">
            <h3 class="text-lg font-semibold mb-4 border-b border-slate-700 pb-2">Hasil Download</h3>
            
            <div id="resultContent" class="flex flex-col md:flex-row gap-4 items-center md:items-start">
                </div>
        </div>
    </div>

    <footer class="mt-auto py-6 text-slate-500 text-xs">
        &copy; 2026 All Ridzkey Downloader. Powered by Dual Engine.
    </footer>

    <script>
        // --- CONFIGURATION ---
        // Ganti URL ini dengan URL backend kamu (misal Vercel URL)
        // Jika running local, gunakan http://localhost:3000/download
        const API_ENDPOINT = '/download'; 

        const platforms = [
            { id: 'tiktok', name: 'TikTok', icon: 'fa-tiktok', color: 'text-pink-500' },
            { id: 'ig', name: 'Instagram', icon: 'fa-instagram', color: 'text-purple-500' },
            { id: 'yt', name: 'YouTube', icon: 'fa-youtube', color: 'text-red-500' },
            { id: 'spotify', name: 'Spotify', icon: 'fa-spotify', color: 'text-green-500' },
            { id: 'fb', name: 'Facebook', icon: 'fa-facebook', color: 'text-blue-600' },
            { id: 'pin', name: 'Pinterest', icon: 'fa-pinterest', color: 'text-red-600' },
            { id: 'mediafire', name: 'MediaFire', icon: 'fa-fire', color: 'text-blue-400' },
            { id: 'capcut', name: 'CapCut', icon: 'fa-scissors', color: 'text-white' },
        ];

        let activeTab = platforms[0];

        // --- INIT UI ---
        function init() {
            const tabContainer = document.getElementById('platformTabs');
            platforms.forEach(p => {
                const btn = document.createElement('button');
                btn.className = `tab-btn flex items-center gap-2 px-4 py-2 rounded-full border border-slate-600 text-sm whitespace-nowrap transition-all hover:bg-slate-700 ${p.id === activeTab.id ? 'active' : ''}`;
                btn.innerHTML = `<i class="fa-brands ${p.icon}"></i> ${p.name}`;
                btn.onclick = () => switchTab(p, btn);
                tabContainer.appendChild(btn);
            });
        }

        function switchTab(platform, btnElement) {
            activeTab = platform;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btnElement.classList.add('active');
            
            // Update Label
            const labelDiv = document.getElementById('activePlatformLabel');
            labelDiv.innerHTML = `
                <i class="fa-brands ${platform.icon} text-4xl mb-2 ${platform.color}"></i>
                <h2 class="text-xl font-semibold">${platform.name} Downloader</h2>
            `;
            
            // Clear inputs
            document.getElementById('urlInput').value = '';
            hideError();
            document.getElementById('resultSection').classList.add('hidden');
        }

        function showLoading() {
            const btn = document.getElementById('downloadBtn');
            btn.disabled = true;
            btn.innerHTML = `<div class="loader"></div>`;
        }

        function resetButton() {
            const btn = document.getElementById('downloadBtn');
            btn.disabled = false;
            btn.innerHTML = `<span>Download Sekarang</span><i class="fa-solid fa-download"></i>`;
        }

        function showError(msg) {
            const errDiv = document.getElementById('errorMsg');
            errDiv.innerText = msg;
            errDiv.classList.remove('hidden');
        }

        function hideError() {
            document.getElementById('errorMsg').classList.add('hidden');
        }

        // --- CORE LOGIC ---
        async function processDownload() {
            const url = document.getElementById('urlInput').value.trim();
            if (!url) return showError("Harap masukkan URL terlebih dahulu.");
            
            hideError();
            showLoading();

            try {
                // Request ke Backend kita (bukan langsung ke API deline)
                const res = await fetch(`${API_ENDPOINT}?url=${encodeURIComponent(url)}`);
                const data = await res.json();

                if (!res.ok || (data.status === false)) {
                    throw new Error(data.message || "Gagal memproses link.");
                }

                renderResult(data);

            } catch (err) {
                console.error(err);
                showError(err.message || "Server sedang sibuk, silakan coba kembali.");
            } finally {
                resetButton();
            }
        }

        function renderResult(data) {
            const container = document.getElementById('resultSection');
            const content = document.getElementById('resultContent');
            container.classList.remove('hidden');

            // Logika render berdasarkan struktur API Deline (harus disesuaikan dengan output aslinya)
            // Ini contoh generic handling
            let html = '';
            
            // Thumbnail (jika ada)
            // Cek berbagai kemungkinan key dari response API
            const thumb = data.thumbnail || data.cover || data.image; 
            if(thumb) {
                html += `<img src="${thumb}" class="w-full md:w-48 rounded-lg object-cover shadow-md mb-4 md:mb-0">`;
            }

            html += `<div class="flex-1 w-full text-sm">`;
            
            // Judul
            const title = data.title || data.text || data.caption || 'File ditemukan';
            html += `<h4 class="font-bold text-lg mb-2 line-clamp-2">${title}</h4>`;

            // Tombol Download Media
            // Loop data url jika array atau single object
            const downloadUrl = data.url || data.video || data.music || data.audio;
            
            if (downloadUrl) {
                if (Array.isArray(downloadUrl)) {
                    downloadUrl.forEach((link, i) => {
                         html += createDownloadButton(link, `Download File ${i+1}`);
                    });
                } else {
                     html += createDownloadButton(downloadUrl, "Download File Utama");
                }
            } else {
                html += `<p class="text-yellow-400">Media ditemukan tapi link tidak standar. Cek console.</p>`;
                console.log(data);
            }

            html += `</div>`;
            content.innerHTML = html;
        }

        function createDownloadButton(link, text) {
            return `
            <a href="${link}" target="_blank" class="block w-full bg-slate-700 hover:bg-slate-600 text-white text-center py-3 rounded-lg mt-2 transition-colors border border-slate-600">
                <i class="fa-solid fa-download mr-2"></i> ${text}
            </a>`;
        }

        init();
    </script>
</body>
</html>
