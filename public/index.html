<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Ridzkey Downloader v3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: #0f172a; color: white; font-family: sans-serif; }
        .progress-bar { height: 8px; background: #1e293b; border-radius: 4px; overflow: hidden; display: none; }
        #fill { width: 0%; height: 100%; background: #3b82f6; transition: width 0.5s; }
    </style>
</head>
<body class="flex flex-col items-center p-6">

    <div class="w-full max-w-md bg-slate-800 p-6 rounded-3xl shadow-2xl border border-slate-700 mt-10">
        <h1 class="text-2xl font-black text-center text-blue-500 mb-6">RIDZKEY HYPER-FAST</h1>
        
        <input type="text" id="urlInput" placeholder="Tempel link (TikTok, IG, YT, FB)..." 
            class="w-full p-4 bg-slate-900 border border-slate-700 rounded-2xl mb-4 outline-none focus:ring-2 focus:ring-blue-500 text-sm">

        <button onclick="startProcess()" id="mainBtn" class="w-full bg-blue-600 hover:bg-blue-500 py-4 rounded-2xl font-bold transition-all shadow-lg active:scale-95">
            DAPATKAN VIDEO
        </button>

        <div class="progress-bar mt-6" id="pBar">
            <div id="fill"></div>
        </div>
        <p id="status" class="text-center text-[10px] text-slate-500 mt-2"></p>
    </div>

    <div id="result" class="w-full max-w-md mt-6 hidden bg-slate-800 p-4 rounded-3xl border border-slate-700">
        <div id="preview" class="rounded-2xl overflow-hidden mb-4 bg-black"></div>
        <div id="actions" class="space-y-3"></div>
    </div>

    <script>
        async function startProcess() {
            const url = document.getElementById('urlInput').value;
            const btn = document.getElementById('mainBtn');
            const pBar = document.getElementById('pBar');
            const fill = document.getElementById('fill');
            const status = document.getElementById('status');
            const result = document.getElementById('result');

            if(!url) return;

            // Reset UI
            result.classList.add('hidden');
            btn.disabled = true;
            pBar.style.display = 'block';
            
            // Simulasi Progress (User Experience)
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if(progress > 90) clearInterval(interval);
                fill.style.width = Math.min(progress, 90) + '%';
                status.innerText = `Sedang menganalisis server... ${Math.floor(progress)}%`;
            }, 300);

            try {
                // Panggil API utama (Gunakan endpoint /download yang sebelumnya)
                const r = await fetch(`/download?url=${encodeURIComponent(url)}`);
                const json = await r.json();
                
                clearInterval(interval);
                fill.style.width = '100%';
                status.innerText = "Selesai!";

                setTimeout(() => {
                    renderResult(json.data || json);
                    btn.disabled = false;
                    pBar.style.display = 'none';
                    fill.style.width = '0%';
                }, 500);

            } catch (e) {
                clearInterval(interval);
                status.innerText = "Gagal. Coba link lain.";
                btn.disabled = false;
            }
        }

        function renderResult(d) {
            const result = document.getElementById('result');
            const preview = document.getElementById('preview');
            const actions = document.getElementById('actions');
            result.classList.remove('hidden');

            // Cari Link Video secara agresif
            let video = d.video || d.url || d.link || (d.urls ? d.urls[0] : null);
            if(!video && d.media) video = d.media[0].url || d.media[0];
            
            let thumb = d.thumbnail || d.cover || d.image || '';

            preview.innerHTML = video ? `<video src="${video}" controls class="w-full"></video>` : `<img src="${thumb}" class="w-full">`;
            
            let html = `<p class="text-xs font-bold mb-2">${d.title || 'Video Berhasil Ditemukan'}</p>`;
            
            if(video) {
                html += `<a href="${video}" target="_blank" class="block w-full bg-green-600 text-center py-4 rounded-xl font-bold text-sm shadow-lg">DOWNLOAD SEKARANG (MP4)</a>`;
            } else {
                html += `<p class="text-red-400 text-center text-xs">Link video tidak ditemukan. API sedang limit.</p>`;
            }
            
            actions.innerHTML = html;
        }
    </script>
</body>
</html>
